(this["webpackJsonpbus-eta"]=this["webpackJsonpbus-eta"]||[]).push([[0],{107:function(e){e.exports=JSON.parse("{}")},128:function(e,t,n){"use strict";n.r(t);var c=n(0),a=n.n(c),i=n(15),r=n.n(i),s=n(88),o=n(23),l=n(172),j=n(178),u=n(180),b=n(176),f=n(70),d=n.n(f),h=n(181),O=n(130),p=n(131),x=n(186),m=n(182),g=n(183),v=n(188),S=n(71),y=n(87),w=n(190),k=n(177),C=n(179),E=n(39),M=n.n(E),_=n(40),A=n(89),R=n(184),B=n(185),I=(n(107),n(35)),N=n(86),H=n(8),Y=Object(l.a)({option:{fontSize:15,"& > span":{marginRight:10,fontSize:18}}}),T=a.a.forwardRef((function(e,t){var n=e.children,c=e.role,i=Object(A.a)(e,["children","role"]),r=Array.isArray(n)?n.length:0;return Object(H.jsx)("div",{ref:t,children:Object(H.jsx)("div",Object(_.a)(Object(_.a)({},i),{},{children:Object(H.jsx)(N.a,{height:250,width:1e3,rowHeight:36,overscanCount:5,rowCount:r,rowRenderer:function(e){return a.a.cloneElement(n[e.index],{style:e.style})},role:c})}))})}));function L(e){var t=Y(),n=Object(c.useState)(!0),i=Object(o.a)(n,2),r=i[0],s=i[1],l=Object(c.useState)([]),j=Object(o.a)(l,2),u=j[0],b=j[1];return Object(c.useEffect)((function(){fetch("https://data.etabus.gov.hk/v1/transport/kmb/stop").then((function(e){return e.json()})).then((function(e){console.log(e),b(e.data),s(!1)}))}),[]),Object(c.useEffect)((function(){console.log("useeffect get station",void fetch("https://data.etabus.gov.hk/v1/transport/kmb/stop").then((function(e){return e.json()})).then((function(e){return e.data})))}),[]),r?"Loading":Object(H.jsx)(B.a,{id:"country-busstop",onChange:function(t,n){null!==n&&e.changeSelectStop(n.stop)},defaultValue:u.find((function(t){return t.stop===e.defaultStop})),ListboxComponent:T,options:u,classes:{option:t.option},autoHighlight:!0,getOptionLabel:function(e){return e.name_tc+" "+e.name_en},renderOption:function(e){return Object(H.jsxs)(a.a.Fragment,{children:[e.name_tc," ",e.name_en]})},renderInput:function(e){return Object(H.jsx)(R.a,Object(_.a)(Object(_.a)({},e),{},{label:"Choose a bus stop",variant:"outlined",inputProps:Object(_.a)(Object(_.a)({},e.inputProps),{},{autoComplete:"new-password"})}))}})}var D=n.p+"static/media/kmb-water.23d62c4c.png",J=Object(l.a)((function(e){return{title:{flexGrow:2,align:"center"},menuButton:{marginRight:e.spacing(2)},typography:{align:"center"},min:{align:"center"}}})),q=Object(y.a)();q=Object(w.a)(q);var z=function(e,t){var n=J(),a=Object(c.useState)([]),i=Object(o.a)(a,2),r=i[0],s=i[1],l=Object(c.useState)(),u=Object(o.a)(l,2),b=u[0],f=u[1],d=Object(c.useState)(),h=Object(o.a)(d,2),x=h[0],m=h[1],g=Object(c.useState)(e.defaultStop?e.defaultStop:"9583BCF159B682BA"),v=Object(o.a)(g,2),S=v[0],y=v[1],w=Object(c.useState)(e.defaultnumETA?e.defaultnumETA:1),E=Object(o.a)(w,2),_=E[0],A=E[1],R=_>0,B=function(){console.log("fetchKMB"),fetch("https://data.etabus.gov.hk/v1/transport/kmb/stop-eta/"+S).then((function(e){return e.json()})).then((function(t){console.log(t),s(t.data.filter((function(t){return t.eta_seq<=_&&1===t.service_type&&(!!e.isSpecialRoute||!t.rmk_en.includes("route only"))}))),f(t.generated_timestamp),m(M()())}))},N=function(e){var t=M()(e),n=-1*M()().diff(t,"seconds"),c=-1*M()().diff(t,"minutes");return null==e?Object(H.jsx)(O.a,{variant:I.isMobile?"subtitle2":"h5",children:"\u6c92\u6709\u73ed\u6b21"}):Object(H.jsx)(O.a,{variant:I.isMobile?"h6":"h4",children:n>60?c+" min":"- min"})};return Object(c.useEffect)((function(){B();var e=setInterval((function(){B()}),5e3);return function(){return clearInterval(e)}}),[S,_,e.isSpecialRoute]),Object(c.useImperativeHandle)(t,(function(){return{selectStop:S,numETA:_}}),[S,_]),Object(H.jsx)(k.a,{theme:q,children:Object(H.jsxs)(j.a,{children:[Object(H.jsxs)(j.a,{container:!0,style:{padding:"5px",minWidth:I.isMobile?"60vw":"40vw"},children:[Object(H.jsx)(j.a,{container:!0,direction:"row",justify:"space-between",alignItems:"center",children:Object(H.jsx)(j.a,{align:"center",style:{flex:2},children:Object(H.jsx)(L,{changeSelectStop:function(e){y(e)},defaultStop:e.defaultStop})})}),Object(H.jsx)(j.a,{alignItems:"left",justifyContent:"center",children:Object(H.jsxs)(C.a,{children:[Object(H.jsx)(p.a,{onClick:function(){A(_+1)},children:"+"}),R&&Object(H.jsx)(p.a,{disabled:!0,children:_}),R&&Object(H.jsx)(p.a,{onClick:function(){A(_-1)},children:"-"})]})}),Object(H.jsxs)(j.a,{direction:"row",style:{flex:1,align:"center"},children:[Object(H.jsxs)(O.a,{align:"right",variant:"subtitle2",children:["Last Update: ",M()(b).format("YYYY/MM/DD HH:mm:ss")]}),Object(H.jsxs)(O.a,{align:"right",variant:"subtitle2",children:["Last Refresh:"," ",M()(x).format("YYYY/MM/DD HH:mm:ss")]})]})]}),Object(H.jsx)(j.a,{direction:"row",justify:"space-between",alignItems:"center",children:r.map((function(e,t){return Object(H.jsxs)(j.a,{container:!0,direction:"row",justify:"space-between",alignItems:"center",style:{minHeight:"10vh"},children:[Object(H.jsx)(j.a,{style:{flex:1},children:1===e.eta_seq&&Object(H.jsx)(O.a,{align:"center",variant:"h3",children:e.route})}),Object(H.jsx)(j.a,{style:{flex:4},children:1===e.eta_seq&&Object(H.jsxs)(O.a,{align:"center",variant:"h5",className:n.typography,children:[Object(H.jsx)(O.a,{variant:"h5",className:n.typography,children:e.dest_tc}),!I.isMobile&&Object(H.jsx)(O.a,{variant:"h6",className:n.typography,children:e.dest_en})]})}),Object(H.jsx)(j.a,{style:{flex:1},children:Object(H.jsxs)(O.a,{align:"center",className:n.min,children:[N(e.eta),Object(H.jsx)(O.a,{variant:I.isMobile?"subtitle2":"h6",children:e.rmk_tc})]})}),!I.isMobile&&Object(H.jsx)("img",{src:D,className:"photo",alt:"KMB",width:"100px",height:"100px"})]})}))})]})})},F=Object(c.forwardRef)(z),G=Object(l.a)((function(e){return{BusStop:{flexGrow:2,align:"center"}}}));function K(){var e=G(),t=Object(c.useState)(1),n=Object(o.a)(t,2),a=(n[0],n[1],Object(c.useState)(!1)),i=Object(o.a)(a,2),r=i[0],l=i[1],f=Object(c.useState)(!1),y=Object(o.a)(f,2),w=y[0],k=y[1],C=Object(c.useState)([]),E=Object(o.a)(C,2),M=E[0],_=E[1],A=Object(c.useState)([]),R=Object(o.a)(A,2),B=R[0],I=R[1],N=new S.a;return Object(c.useEffect)((function(){_((function(e){return Array(B.length).fill().map((function(t,n){return e[n]||Object(c.createRef)()}))}))}),[B]),Object(c.useEffect)((function(){console.log("elRefs",M)}),[M]),Object(c.useEffect)((function(){var e=N.get("station");e&&I(e)}),[]),Object(H.jsxs)(j.a,{children:[Object(H.jsx)(u.a,{color:"secondary",children:Object(H.jsxs)(h.a,{children:[Object(H.jsx)(b.a,{edge:"start",className:e.menuButton,color:"inherit","aria-label":"menu",onClick:function(){l(!0)},children:Object(H.jsx)(d.a,{})}),Object(H.jsx)(O.a,{variant:"h6",className:e.title,children:"Bus Arrival Time"})]})}),Object(H.jsx)(h.a,{}),Object(H.jsx)(j.a,{container:!0,direction:"row",justify:"flex-start",alignItems:"baseline",children:B.map((function(e,t){return Object(H.jsx)(j.a,{style:{flex:1},children:Object(H.jsx)(F,{ref:M[t],isSpecialRoute:w,defaultStop:e.current.selectStop,defaultnumETA:e.current.numETA})})}))}),Object(H.jsxs)(x.a,{open:r,onOpen:r,children:[Object(H.jsx)(p.a,{onClick:function(){l(!1)},children:"Close"}),Object(H.jsx)(p.a,{onClick:function(){var e=JSON.stringify(M);console.log(M),console.log(e),(new S.a).set("station",e,{path:"/",maxAge:2147483647})},children:"Save"}),Object(H.jsx)(p.a,{onClick:function(){I((function(e){return[].concat(Object(s.a)(e),[{current:{stop:"",numETA:1}}])}))},children:"add"}),Object(H.jsx)(p.a,{onClick:function(){I([])},children:"remove all"}),Object(H.jsx)(m.a,{column:!0,children:Object(H.jsx)(g.a,{control:Object(H.jsx)(v.a,{checked:w,onChange:function(e){k(e.target.checked)}}),label:"\u7279\u5225\u8def\u7dda"})})]})]})}var P=document.getElementById("root");r.a.render(Object(H.jsx)(c.StrictMode,{children:Object(H.jsx)(K,{})}),P)}},[[128,1,2]]]);
//# sourceMappingURL=main.ba962b95.chunk.js.map